
# FaultMaven Frontend Design Document (v1.1)

**Date:** 2025-05-02  
**Author:** [Your Name] / CodeMaven Assistant  
**Scope:** Frontend Architecture for FaultMaven Website/Portal and Browser Extension

---

## ğŸ¯ Objective

To design and implement a high-performance, scalable, and consistent frontend for FaultMaven â€” an AI-powered troubleshooting assistant. This includes:

- A **React-based public website and user portal** (using Next.js)
- A **Plasmo-powered browser extension sidebar** for in-context assistance
- A **shared component library and design system** using Tailwind CSS and shadcn/ui
- Robust **authentication** and seamless **backend API integration**
- A **developer-friendly structure** and modern tooling

---

## ğŸ§± Project Structure & Repositories

To balance development efficiency, deployment independence, and security considerations, a multi-repo approach is adopted:

### 1. Main Monorepo: `faultmaven/`

Contains the core backend, web frontend, shared packages, and documentation. Managed using **pnpm workspaces** (or yarn/npm workspaces), potentially orchestrated by **Turborepo**.

```plaintext
faultmaven/
â”œâ”€â”€ app/                # Backend (Python, FastAPI)
â”œâ”€â”€ config/             # Backend config
â”œâ”€â”€ docs/               # Architecture/Design Docs (like this one)
â”œâ”€â”€ packages/           # Shared internal packages (monorepo)
â”‚   â”œâ”€â”€ ui/             # Shared UI components (@faultmaven/ui source)
â”‚   â””â”€â”€ types/          # Shared TypeScript types (optional @faultmaven/types)
â”œâ”€â”€ frontend/           # Web App (Next.js)
â”œâ”€â”€ scripts/            # Utility scripts
â”œâ”€â”€ tests/              # Backend tests
â”œâ”€â”€ docker-compose.yml  # For local dev environment
â”œâ”€â”€ Dockerfile          # Backend Dockerfile
â”œâ”€â”€ package.json        # Root package for monorepo tooling
â”œâ”€â”€ pnpm-workspace.yaml # Or equivalent workspace config
â””â”€â”€ README.md
```

### 2. Extension Repo: `faultmaven-extension/` (Separate Git Repository)

Contains only the code specific to the browser extension.

**Benefits:**

- Independent deployment cycle (Chrome Web Store)
- Focused issue tracking
- Easier security auditing
- Smaller extension package size

```plaintext
faultmaven-extension/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content/        # Content scripts
â”‚   â”œâ”€â”€ sidebar.tsx     # Main sidebar UI (React)
â”‚   â”œâ”€â”€ background.ts   # Background service worker
â”‚   â””â”€â”€ ...             # Other Plasmo components
â”œâ”€â”€ public/             # Static assets for extension
â”œâ”€â”€ package.json        # Extension dependencies (incl. @faultmaven/ui)
â”œâ”€â”€ tsconfig.json
â””â”€â”€ README.md
```

Note: `manifest.json` is typically auto-generated by Plasmo based on `package.json` and Plasmo config.

---

## ğŸ”„ Code Sharing & Integration Workflow

### Shared Code as Packages

- **@faultmaven/ui**: Contains React components styled with Tailwind CSS, built using shadcn/ui principles. Developed within the `faultmaven/packages/ui/` monorepo directory.
- **@faultmaven/types** *(optional)*: Shared TypeScript interfaces/types. Developed in `faultmaven/packages/types/`.

**Publishing & Consumption:**

- Shared packages are published to a private registry (e.g., GitHub Packages, Verdaccio) or referenced via Git.
- `faultmaven/frontend` and `faultmaven-extension` list `@faultmaven/ui` as a dependency.

### CI/CD for Synchronization

```yaml
# Example: faultmaven-extension/.github/workflows/publish.yml
steps:
  - uses: actions/checkout@v4
  - run: pnpm install @faultmaven/ui@latest
  - run: pnpm run build
  - uses: plasmo/upload-to-store@v1
```

**Benefits:**

- âœ… Lightweight, auditable browser extension
- âœ… Reusable, versioned components across frontend/extension
- âœ… Independent tech evolution

---

## ğŸŒ Web Frontend (`faultmaven/frontend/`)

- **Framework:** Next.js (v14+ App Router), React 18+, TypeScript
- **Styling:** Tailwind CSS
- **Components:** shadcn/ui-based, wrapped in `@faultmaven/ui`
- **Fonts:** Poppins or Inter (self-hosted or CDN)
- **Pages:** Landing, Auth, Dashboard
- **Data Fetching:** React Query or SWR
- **Global State (non-server):** Zustand or Jotai

---

## ğŸ§© Browser Extension (`faultmaven-extension/`)

- **Framework:** Plasmo (React + TypeScript)
- **UI:** Sidepanel, powered by `@faultmaven/ui`
- **Styling:** Tailwind CSS
- **Functionality:** 
  - Inject content scripts
  - Capture in-page context
  - Send queries/data to API
  - Display insights
- **Storage:** 
  - `chrome.storage.session` for tokens
  - `chrome.storage.local` for persistent settings

---

## ğŸ” Authentication Flow

1. User logs in via `faultmaven/frontend`.
2. Backend issues tokens (JWT access & refresh).
3. Web stores tokens (refresh token in cookie, access token in memory/session).
4. Extension receives token via:
   - Cookie read on backend, or
   - Secure session sync via postMessage or API call
5. Extension stores access token in `chrome.storage.session`.

---

## âœ… Summary

This architecture ensures:

- Seamless UX between web and extension
- Consistent UI via shared components
- Secure, scalable deployment strategy
- Flexibility to evolve parts of the stack independently


---
---
---

# FaultMaven Frontend Design Document (v1.2)

**Date:** 2025-05-12
**Author:** [Your Name] / CodeMaven Assistant
**Scope:** Frontend Architecture for FaultMaven Website/Portal and WXT-based Browser Extension

---

## ğŸ¯ Objective

To design and implement a high-performance, scalable, and consistent frontend for FaultMaven â€” an AI-powered troubleshooting assistant. This includes:

- A **React-based public website and user portal** (using Next.js)
- A **WXT-powered browser extension** using the native Chrome Side Panel API for in-context assistance.
- A **shared component library and design system** using Tailwind CSS and shadcn/ui
- Robust **authentication** and seamless **backend API integration**
- A **developer-friendly structure** and modern tooling

---

## ğŸ§± Project Structure & Repositories

To balance development efficiency, deployment independence, and security considerations, a multi-repo approach is adopted:

### 1. Main Monorepo: `faultmaven/`

Contains the core backend, web frontend, shared packages, and documentation. Managed using **pnpm workspaces** (or yarn/npm workspaces), potentially orchestrated by **Turborepo**.

```plaintext
faultmaven/
â”œâ”€â”€ app/                # Backend (Python, FastAPI)
â”œâ”€â”€ config/             # Backend config
â”œâ”€â”€ docs/               # Architecture/Design Docs (like this one)
â”œâ”€â”€ packages/           # Shared internal packages (monorepo)
â”‚   â”œâ”€â”€ ui/             # Shared UI components (@faultmaven/ui source)
â”‚   â””â”€â”€ types/          # Shared TypeScript types (optional @faultmaven/types)
â”œâ”€â”€ frontend/           # Web App (Next.js)
â”œâ”€â”€ scripts/            # Utility scripts
â”œâ”€â”€ tests/              # Backend tests
â”œâ”€â”€ docker-compose.yml  # For local dev environment
â”œâ”€â”€ Dockerfile          # Backend Dockerfile
â”œâ”€â”€ package.json        # Root package for monorepo tooling
â”œâ”€â”€ pnpm-workspace.yaml # Or equivalent workspace config
â””â”€â”€ README.md
```
### 2. Extension Repo: `faultmaven-extension/` *(Separate Git Repository)*

Contains only the code specific to the browser extension, now built using **WXT**.

**Benefits:**

- Independent deployment cycle (Chrome Web Store, etc.)
- Focused issue tracking
- Easier security auditing
- Smaller extension package size

**Updated Project Structure for `faultmaven-extension/` (WXT based):**
```
faultmaven-extension/
â”œâ”€â”€ .output/                      # Build output (WXT managed, not committed)
â”œâ”€â”€ .wxt/                         # WXT generated types/cache (not committed)
â”œâ”€â”€ public/                       # Static assets (icons, etc.) copied to extension root
â”‚   â””â”€â”€ icon/                     # Extension icons
â”œâ”€â”€ src/                          # Primary source code
â”‚   â”œâ”€â”€ assets/                   # CSS, images used by TSX/JS
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ globals.css       # Global styles with Tailwind CSS
â”‚   â”œâ”€â”€ entrypoints/              # WXT entry scripts
â”‚   â”‚   â”œâ”€â”€ background.ts         # Background service worker (session, side panel trigger)
â”‚   â”‚   â”œâ”€â”€ page-content.content.ts # Auto-injected content script for page data
â”‚   â”‚   â””â”€â”€ sidepanel_manual/     # Directory for manually structured side panel
â”‚   â”‚       â”œâ”€â”€ index.html        # HTML shell for the side panel
â”‚   â”‚       â””â”€â”€ main.tsx          # React mounter script for SidePanelApp
â”‚   â”œâ”€â”€ lib/                      # Utility functions shared within the extension
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ config.ts
â”‚   â”‚       â””â”€â”€ messaging.ts
â”‚   â”œâ”€â”€ shared/                   # Shared React components/logic within the extension
â”‚   â”‚   â””â”€â”€ ui/
â”‚   â”‚       â””â”€â”€ SidePanelApp.tsx  # Main React UI component for the side panel
â”œâ”€â”€ package.json                  # Extension dependencies (incl. @faultmaven/ui)
â”œâ”€â”€ pnpm-lock.yaml                # Or other lock file
â”œâ”€â”€ postcss.config.cjs            # PostCSS configuration (for Tailwind)
â”œâ”€â”€ tailwind.config.cjs           # Tailwind CSS configuration
â”œâ”€â”€ tsconfig.json                 # TypeScript configuration
â”œâ”€â”€ wxt.config.ts                 # WXT configuration file
â””â”€â”€ README.md
```

### Note on manifest.json

The `manifest.json` file is auto-generated by **WXT** based on the `wxt.config.ts` file and conventions within the `src/entrypoints/` directory. Due to WXT 0.20.6 limitations with React-based side panels requiring a dedicated HTML file, the `side_panel.default_path` is manually specified within the manifest object in `wxt.config.ts` to point to the built path of `src/entrypoints/sidepanel_manual/index.html` (e.g., `"sidepanel_manual.html"` or `"entrypoints/sidepanel_manual/index.html"` depending on WXT's output structure).

### ğŸ”„ Code Sharing & Integration Workflow

#### Shared Code as Packages

- **`@faultmaven/ui`**: Contains React components styled with Tailwind CSS, built using **shadcn/ui** principles. Developed within the `faultmaven/packages/ui/` monorepo directory.
- **`@faultmaven/types` (optional)**: Shared TypeScript interfaces/types. Developed in `faultmaven/packages/types/`.

#### Publishing & Consumption

- Shared packages are published to a private registry (e.g., GitHub Packages, Verdaccio) or referenced via Git.
- Both `faultmaven/frontend` and `faultmaven-extension` list `@faultmaven/ui` as a dependency.

#### CI/CD for Synchronization
# Example: faultmaven-extension/.github/workflows/publish.yml
# (Conceptual, actual action for store upload may vary)
name: Build and Package Extension

on:
  push:
    tags:
      - 'v*.*.*' # Trigger on version tags

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8 # Specify your pnpm version

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Specify your Node.js version
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile # Might include @faultmaven/ui

      - name: Build extension for production
        run: pnpm wxt build # WXT command to build for production

      - name: Package extension for store
        run: pnpm wxt zip # Creates a zip file in .output/

      # Example: Upload to Chrome Web Store (using a community action)
      # Replace with your chosen deployment action and configuration
      # - name: Upload to Chrome Web Store
      #   uses: mnao305/chrome-extension-upload@vX.X.X # Check for latest version
      #   with:
      #     file-path: .output/chrome-mv3.zip # Adjust if WXT names it differently
      #     extension-id: YOUR_EXTENSION_ID
      #     client-id: ${{ secrets.CHROME_CLIENT_ID }}
      #     client-secret: ${{ secrets.CHROME_CLIENT_SECRET }}
      #     refresh-token: ${{ secrets.CHROME_REFRESH_TOKEN }}
      #     # publish: true # Set to false for draft upload

      ### Benefits

- âœ… **Lightweight, auditable browser extension**
- âœ… **Reusable, versioned components across frontend/extension**
- âœ… **Independent tech evolution**


### ğŸŒ Web Frontend (`faultmaven/frontend/`)

- **Framework:** Next.js (v14+ App Router), React 18+, TypeScript
- **Styling:** Tailwind CSS
- **Components:** shadcn/ui-based, wrapped in `@faultmaven/ui`
- **Fonts:** Poppins or Inter (self-hosted or via CDN)
- **Pages:** Landing, Auth, Dashboard
- **Data Fetching:** React Query or SWR
- **Global State (non-server):** Zustand or Jotai

---

### ğŸ§© Browser Extension (`faultmaven-extension/`)

- **Framework:** WXT (version 0.20.6, utilizing Vite for building), React 18+, TypeScript  
- **UI:**
  - Utilizes the native Chrome Side Panel API.
  - The UI is a React application located at `src/shared/ui/SidePanelApp.tsx`.
  - The side panel is loaded via a manually created HTML file (`src/entrypoints/sidepanel_manual/index.html`) and a corresponding React mounter script (`src/entrypoints/sidepanel_manual/main.tsx`).
  - The `side_panel.default_path` in the manifest is manually defined in `wxt.config.ts` to point to the built path of this HTML file, due to WXT 0.20.6 behavior with direct `.tsx` side panel entrypoints.
  - UI components are powered by `@faultmaven/ui` (if used) and custom components.
  - **Styling:** Tailwind CSS (configured via `tailwind.config.cjs` and `postcss.config.cjs`, with global styles imported into the side panel's React mounter script).

- **Functionality:**
  - **Side Panel Activation:** Triggered via a `chrome.action.onClicked` listener in the background script (`src/entrypoints/background.ts`), which calls `chrome.sidePanel.open()`.
  - **Page Interaction:**
    - An auto-injected content script (`src/entrypoints/page-content.content.ts`) matching relevant URLs (e.g., initially `https://www.example.com/*` for developmentâ€”with plans to expand to `<all_urls>` for production after resolving dev HMR stability) listens for messages from the side panel.
    - The side panel UI (`SidePanelApp.tsx`) sends a message (e.g., `{ action: "getPageContent" }`) directly to `page-content.content.ts` in the active tab using `chrome.tabs.sendMessage()` to retrieve page data (such as `document.documentElement.outerHTML`).
  - **Background Operations:**
    - The background script (`src/entrypoints/background.ts`) manages session IDs (using `chrome.storage.local`) and handles other core extension logic that isn't tied to a specific page's DOM or UI.
    - The side panel communicates with the background script using `chrome.runtime.sendMessage()` for session management (for instance, invoking actions like `getSessionId` or `clearSession`).
  - **API Interaction:** The side panel UI (`SidePanelApp.tsx`) directly sends queries/data to the backend API via Workspace.
  - **Display Insights:** Managed by `SidePanelApp.tsx`.

- **Storage:**
  - Uses `chrome.storage.local` for the sessionId (as implemented) and other persistent user settings.
  - `chrome.storage.session` could be considered for session-only authentication tokens if distinct from the internal sessionId.

#### Browser Extension - Styling

When `@faultmaven/ui` is consumed by the `faultmaven-extension`, the extension's `tailwind.config.cjs` file must be updated. Its `content` array needs to include the path to the installed `@faultmaven/ui` package's component files within `node_modules` (e.g., `"./node_modules/@faultmaven/ui/dist/**/*.tsx"`). This allows the extension's Tailwind CSS build process to scan the shared components for utility classes and include them in the extension's final CSS bundle.

For local development across the monorepo (for `@faultmaven/ui`) and the separate extension repository, techniques like `pnpm link` or a local npm registry (e.g., Verdaccio) can be used to streamline the workflow. This approach enables you to use updated shared components in the extension without the need for frequent publishing to a remote private registry.

---

### ğŸ” Authentication Flow

- **User Login:** Users log in via `faultmaven/frontend`.
- **Backend Issues Tokens:** The backend issues tokens (JWT access and refresh).
  - The web application stores tokens with a refresh token in an httpOnly cookie and the access token in memory or session storage.
- **Extension Receives Token:**
  - An API endpoint provided by `faultmaven/app` (triggered, for example, after a user action or redirect signifying a completed web login) securely provides the token. This endpoint requires access to the user's session or httpOnly cookie.
  - Alternatively, secure message passing can occur from the web app (hosted on a FaultMaven domain) to a content script, which then relays the token to the background script (using methods like `window.postMessage` with the `externally_connectable` manifest property or standard `chrome.runtime.sendMessage` if established in the trusted flow).
- **Extension Stores Access Token:**
  - **Access tokens:** Stored in `chrome.storage.session` (recommended for limiting lifespan when the browser is closed).
  - **Refresh tokens:** May be stored in `chrome.storage.local` if persistence is necessary, provided they are handled with appropriate security measures (such as encryption at rest, noting that extension storage is generally isolated).  
    *(Note: The current sessionId implementation uses `chrome.storage.local` and is distinct from primary authentication tokens.)*

---

### âœ… Summary

This architecture ensures:

- **Seamless UX** between the web application and browser extension.
- **Consistent UI** through the use of shared components.
- **Secure, scalable deployment strategy** across the stack.
- **Flexibility to evolve** parts of the stack independently.
- The modern **WXT framework** is utilized for browser extension development, leveraging Vite's performance and features.
