# FaultMaven Environment Configuration (OODA Framework v3.2.0)
# Copy this file to .env and edit with your values

# =============================================================================
# LLM Provider Configuration
# =============================================================================

# Primary chat provider (openai, anthropic, fireworks)
CHAT_PROVIDER=openai

# OpenAI Configuration
OPENAI_API_KEY=your_openai_api_key_here
OPENAI_MODEL=gpt-4o
OPENAI_API_BASE=https://api.openai.com/v1

# Anthropic Configuration
ANTHROPIC_API_KEY=your_anthropic_api_key_here
ANTHROPIC_MODEL=claude-3-5-sonnet-20241022
ANTHROPIC_API_BASE=https://api.anthropic.com/v1

# Fireworks AI Configuration
FIREWORKS_API_KEY=your_fireworks_api_key_here
FIREWORKS_MODEL=accounts/fireworks/models/llama-v3p1-70b-instruct
FIREWORKS_API_BASE=https://api.fireworks.ai/inference/v1

# Local LLM Configuration (for self-hosted models)
LOCAL_LLM_MODEL=llama2-7b                           # Model name (directory in /var/lib/llm/)
LOCAL_LLM_URL=http://localhost:5000                 # Local LLM server endpoint

# LLM Provider Behavior
STRICT_PROVIDER_MODE=false                          # If true, disable fallback to other providers
LLM_REQUEST_TIMEOUT=30                              # Request timeout in seconds
LLM_MAX_RETRIES=3                                   # Maximum retry attempts
LLM_MAX_TOKENS=4096                                 # Maximum tokens per request
LLM_CONTEXT_WINDOW=128000                           # Context window size

# =============================================================================
# Service Connections (K8s Cluster - Hybrid Ingress + NodePort)
# =============================================================================

# Redis Session Storage (NodePort - TCP binary protocol requires direct access)
REDIS_HOST=192.168.0.111
REDIS_PORT=30379
REDIS_PASSWORD=faultmaven-dev-redis-2025
REDIS_DB=0

# Session Timeout Configuration
SESSION_TIMEOUT_MINUTES=180                         # Default session timeout (3 hours)
SESSION_CLEANUP_INTERVAL_MINUTES=30                 # How often to run cleanup (30 minutes)
SESSION_MAX_MEMORY_MB=100                           # Maximum memory per session
SESSION_HEARTBEAT_INTERVAL_SECONDS=30               # Frontend heartbeat interval
MAX_SESSIONS_PER_USER=10                            # Maximum concurrent sessions per user

# Knowledge Base (ChromaDB)
CHROMADB_URL=http://chromadb.faultmaven.local:30080
CHROMADB_API_KEY=your_chromadb_token_here
CHROMADB_COLLECTION=faultmaven_kb
EMBEDDING_MODEL=BAAI/bge-m3
SIMILARITY_THRESHOLD=0.7
MAX_SEARCH_RESULTS=10

# PII Protection (Presidio)
PRESIDIO_ANALYZER_URL=http://presidio-analyzer.faultmaven.local:30080
PRESIDIO_ANONYMIZER_URL=http://presidio-anonymizer.faultmaven.local:30080
MIN_SCORE_THRESHOLD=0.8

# Observability (Opik)
OPIK_USE_LOCAL=true
OPIK_LOCAL_URL=http://opik.faultmaven.local:30080
OPIK_LOCAL_HOST=opik.faultmaven.local
OPIK_PROJECT_NAME=FaultMaven Development
OPIK_API_KEY=local-dev-key
OPIK_TRACK_DISABLE=false                            # Set to true to disable all tracing

# Web Search (Tavily)
TAVILY_API_KEY=your_tavily_api_key_here
ENABLE_WEB_SEARCH=true

# =============================================================================
# Application Configuration
# =============================================================================

# Server Settings
HOST=0.0.0.0
PORT=8000
ENVIRONMENT=development
DEBUG=false
LOG_LEVEL=INFO
STRUCTURED_LOGGING=true

# Development Flags
SKIP_SERVICE_CHECKS=false                           # Skip external service checks on startup

# =============================================================================
# OODA Investigation Framework Configuration (v3.2.0)
# =============================================================================

# Investigation Strategy
# - active_incident: Fast, 70% confidence threshold, can skip phases if urgent
# - post_mortem: Thorough, 85% confidence threshold, all phases required
DEFAULT_INVESTIGATION_STRATEGY=active_incident

# OODA Cycle Intensity
# - light: 1-2 iterations per phase (fast, basic investigations)
# - medium: 2-4 iterations per phase (standard, balanced)
# - full: 3-6 iterations per phase (thorough, complex investigations)
DEFAULT_OODA_INTENSITY=medium

# Memory Management (Hierarchical 4-Tier System)
HOT_MEMORY_TOKENS=500                               # Last 2 iterations, full fidelity
WARM_MEMORY_TOKENS=300                              # Iterations 3-5, LLM-summarized
COLD_MEMORY_TOKENS=100                              # Older, key facts only
PERSISTENT_MEMORY_TOKENS=100                        # Always accessible insights

# Phase Control
ENABLE_PHASE_SKIP=true                              # Allow skipping phases in active incidents
MIN_CONFIDENCE_TO_ADVANCE=0.70                      # Minimum confidence to advance to next phase
STALL_DETECTION_ITERATIONS=3                        # Iterations without progress = stalled

# Consultant Mode Settings
PROBLEM_SIGNAL_THRESHOLD=moderate                   # Threshold to offer investigation: weak|moderate|strong
MAX_CONSULTANT_TURNS=5                              # Max turns before suggesting Lead Investigator mode

# =============================================================================
# Protection System Configuration
# =============================================================================

# General Protection Settings
PROTECTION_ENABLED=true
PROTECTION_FAIL_OPEN=true                           # Continue on protection failure (safe for dev)
BASIC_PROTECTION_ENABLED=true
INTELLIGENT_PROTECTION_ENABLED=true

# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST_SIZE=10

# PII Protection
PROTECTION_ENTITIES=[CREDIT_CARD,EMAIL_ADDRESS,PHONE_NUMBER,US_SSN,IP_ADDRESS]

# Behavioral Analysis
BEHAVIORAL_ANALYSIS_ENABLED=true
BEHAVIOR_ANALYSIS_WINDOW=3600
BEHAVIOR_PATTERN_THRESHOLD=0.8

# ML Anomaly Detection
ML_ANOMALY_DETECTION_ENABLED=false                  # Disabled by default (requires training)
ML_MODEL_PATH=/tmp/faultmaven_ml_models
ML_TRAINING_ENABLED=false
ML_ONLINE_LEARNING_ENABLED=false

# Circuit Breakers
SMART_CIRCUIT_BREAKERS_ENABLED=true
CIRCUIT_FAILURE_THRESHOLD=5
CIRCUIT_TIMEOUT_SECONDS=60

# Reputation System
REPUTATION_SYSTEM_ENABLED=true
REPUTATION_DECAY_RATE=0.05
REPUTATION_RECOVERY_THRESHOLD=0.1

# =============================================================================
# Security Configuration
# =============================================================================

# CORS Configuration
CORS_ALLOW_CREDENTIALS=true
CORS_ALLOW_ORIGINS=["http://localhost:3000","chrome-extension://*","moz-extension://*"]

# JWT Configuration (if auth enabled)
JWT_SECRET_KEY=your_jwt_secret_key_here
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# =============================================================================
# Feature Flags
# =============================================================================

# Core Features
USE_DI_CONTAINER=true
USE_REFACTORED_SERVICES=true
USE_REFACTORED_API=true

# Context Management
ENABLE_TOKEN_AWARE_CONTEXT=true
ENABLE_CONVERSATION_SUMMARIZATION=true
MAX_CONVERSATION_TURNS=20
MAX_CONVERSATION_TOKENS=4000

# Experimental Features
ENABLE_ADVANCED_REASONING=false
ENABLE_MULTI_AGENT=false
ENABLE_WORKFLOW_OPTIMIZATION=false

# =============================================================================
# Upload and File Processing
# =============================================================================

MAX_FILE_SIZE_MB=50
ALLOWED_MIME_TYPES=["text/plain","text/csv","application/json","application/xml","text/xml","application/yaml"]
UPLOAD_TIMEOUT_SECONDS=300
TEMP_STORAGE_PATH=/tmp/faultmaven

# Document Processing
MAX_DOCUMENT_SIZE_MB=10
DOCUMENT_CHUNK_SIZE=1000
DOCUMENT_CHUNK_OVERLAP=100

# =============================================================================
# Observability and Tracing
# =============================================================================

# Targeted Tracing (optional - leave empty to trace all)
OPIK_TRACK_USERS=                                   # Comma-separated user IDs
OPIK_TRACK_SESSIONS=                                # Comma-separated session IDs
OPIK_TRACK_OPERATIONS=                              # Comma-separated operation names

# Performance Monitoring
ENABLE_PERFORMANCE_MONITORING=true
ENABLE_DETAILED_TRACING=false

# Metrics
METRICS_ENABLED=true
METRICS_PORT=9090

# Prometheus Integration (optional)
PROMETHEUS_ENABLED=false
PROMETHEUS_PUSHGATEWAY_URL=http://localhost:9091

# =============================================================================
# Alerting (optional)
# =============================================================================

ALERT_FROM_EMAIL=
ALERT_TO_EMAILS=
ALERT_WEBHOOK_URL=

SMTP_HOST=localhost
SMTP_PORT=587

# =============================================================================
# DEPRECATED SETTINGS (No Longer Used in OODA v3.2.0)
# =============================================================================
# The following settings are no longer applicable and will be removed in future versions:
#
# DOCTOR_PATIENT_PROMPT_VERSION - Replaced by OODA Consultant/Lead Investigator modes
# ENABLE_DYNAMIC_PROMPT_VERSION - Not applicable to OODA framework
# LLM_CLASSIFICATION_MODE - No classification layer in OODA (structured outputs instead)
# PATTERN_CONFIDENCE_THRESHOLD - Not applicable to OODA framework
# ENABLE_MULTIDIMENSIONAL_CONFIDENCE - Not applicable to OODA framework
# PATTERN_WEIGHTED_SCORING - Not applicable to OODA framework
# PATTERN_EXCLUSION_RULES - Not applicable to OODA framework
# ENABLE_STRUCTURE_ANALYSIS - Not applicable to OODA framework
# ENABLE_LINGUISTIC_ANALYSIS - Not applicable to OODA framework
# ENABLE_ENTITY_ANALYSIS - Not applicable to OODA framework
# ENABLE_CONTEXT_ANALYSIS - Not applicable to OODA framework
# ENABLE_DISAMBIGUATION_CHECK - Not applicable to OODA framework
# SELF_CORRECTION_MIN_CONFIDENCE - Not applicable to OODA framework
# SELF_CORRECTION_MAX_CONFIDENCE - Not applicable to OODA framework
# CONFIDENCE_OVERRIDE_THRESHOLD - Not applicable to OODA framework
# ENABLE_LLM_CLASSIFICATION - Not applicable to OODA framework
