# FaultMaven API Architecture Diagram

## Layer Structure and Dependencies

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           TRANSPORT/API LAYER                                  │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        api/v1/routes/                                  │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │  data   │ │knowledge│ │ session │ │  case   │ │  auth   │ │  jobs   │ │   │
│  │  │  .py    │ │  .py    │ │  .py    │ │  .py    │ │  .py    │ │  .py    │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    api/v1/dependencies.py                              │   │
│  │              (FastAPI Dependency Injection)                            │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      api/middleware/                                   │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │logging  │ │rate_lim │ │protection│ │idempot  │ │performance│ │system  │ │   │
│  │  │  .py    │ │  .py    │ │  .py    │ │  .py    │ │  .py    │ │opt .py  │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                            SERVICE LAYER                                       │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        Core Services                                   │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │ agent   │ │  data   │ │knowledge│ │ session │ │  case   │ │planning │ │   │
│  │  │  .py    │ │  .py    │ │  .py    │ │  .py    │ │  .py    │ │  .py    │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    Specialized Services (agentic/)                     │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │workflow │ │classif  │ │tool_    │ │guard    │ │response │ │state    │ │   │
│  │  │engine   │ │engine   │ │broker   │ │rails    │ │synthes  │ │manager  │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  │  ┌─────────┐                                                             │   │
│  │  │error_   │                                                             │   │
│  │  │manager  │                                                             │   │
│  │  └─────────┘                                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        services/base.py                                │   │
│  │              (BaseService with unified logging)                        │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           CORE DOMAIN LAYER                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      core/processing/                                  │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                                   │   │
│  │  │log_     │ │classif  │ │pattern  │                                   │   │
│  │  │analyzer │ │ier.py   │ │learner  │                                   │   │
│  │  └─────────┘ └─────────┘ └─────────┘                                   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      core/knowledge/                                   │   │
│  │  ┌─────────┐ ┌─────────┐                                               │   │
│  │  │advanced │ │ingestion│                                               │   │
│  │  │retrieval│ │  .py    │                                               │   │
│  │  └─────────┘ └─────────┘                                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        core/agent/                                     │   │
│  │  ┌─────────┐ ┌─────────┐                                               │   │
│  │  │ agent   │ │doctrine │                                               │   │
│  │  │  .py    │ │  .py    │                                               │   │
│  │  └─────────┘ └─────────┘                                               │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    core/orchestration/                                 │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                                   │   │
│  │  │troubles │ │ router  │ │skill_   │                                   │   │
│  │  │hooting  │ │  .py    │ │registry │                                   │   │
│  │  │orchestr │ │         │ │  .py    │                                   │   │
│  │  └─────────┘ └─────────┘ └─────────┘                                   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        INFRASTRUCTURE LAYER                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    External Services                                   │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │llm/     │ │persist  │ │caching/ │ │monitor  │ │observab │ │protect  │ │   │
│  │  │providers│ │ence/    │ │         │ │ing/     │ │ility/   │ │ion/     │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │OpenAI   │ │ChromaDB │ │Redis    │ │Metrics  │ │Tracing  │ │Rate     │ │   │
│  │  │Anthropic│ │Redis    │ │Cache    │ │Collector│ │Telemetry│ │Limiting │ │   │
│  │  │Fireworks│ │Stores   │ │         │ │         │ │         │ │         │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                             TOOLS LAYER                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                       │   │
│  │  │registry │ │knowledge│ │web_     │ │enhanced │                       │   │
│  │  │  .py    │ │base.py  │ │search.py│ │knowledge│                       │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘                       │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                           SUPPORTING LAYERS                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                            MODELS LAYER                                │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │   │
│  │  │interfaces│ │  api.py │ │agentic │ │ case.py │ │behavior │ │legacy.py│ │   │
│  │  │  .py    │ │         │ │  .py    │ │         │ │  .py    │ │         │ │   │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │   │
│  │  ┌─────────┐                                                             │   │
│  │  │microserv│                                                             │   │
│  │  │ice_     │                                                             │   │
│  │  │contracts│                                                             │   │
│  │  └─────────┘                                                             │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        CONFIGURATION LAYER                             │   │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐                                   │   │
│  │  │settings │ │feature_ │ │protect  │                                   │   │
│  │  │  .py    │ │flags.py │ │ion.py   │                                   │   │
│  │  └─────────┘ └─────────┘ └─────────┘                                   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                        DEPENDENCY INJECTION & STARTUP                          │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                        container.py                                   │   │
│  │              (Singleton DI Container)                                  │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  Startup Sequence:                                              │   │   │
│  │  │  1. Settings → 2. Infrastructure → 3. Services → 4. Tools      │   │   │
│  │  │  Lazy initialization with interface-based resolution            │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          main.py                                      │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │  FastAPI App Setup:                                            │   │   │
│  │  │  • Middleware Configuration                                     │   │   │
│  │  │  • Route Registration                                           │   │   │
│  │  │  • Startup/Shutdown Handlers                                    │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

## Request Flow Diagram

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Client    │───▶│ API Route   │───▶│ Dependencies│───▶│  Service    │───▶│ Core Domain │
│  Request    │    │ (FastAPI)   │    │ (DI Container)│    │   Layer     │    │   Layer     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
                                                              │
                                                              ▼
                                                   ┌─────────────┐    ┌─────────────┐
                                                   │Infrastructure│───▶│ Tools Layer │
                                                   │   Layer     │    │             │
                                                   └─────────────┘    └─────────────┘
```

## Key Architectural Patterns

1. **Dependency Injection**: All layers connected via DI container
2. **Interface Segregation**: Heavy use of interfaces for testability  
3. **Lazy Initialization**: Objects created on-demand
4. **Unified Logging**: All services use BaseService with consistent logging
5. **Error Handling**: Centralized exception handling with FaultMavenException hierarchy
6. **Configuration**: Single source of truth via settings.py

## Navigation Guide

- **Start with**: `main.py` for app setup, `container.py` for dependencies
- **API endpoints**: Look in `api/v1/routes/`
- **Business logic**: Check `services/` folder
- **Core algorithms**: Examine `core/` folder  
- **External integrations**: Look in `infrastructure/`
- **Interfaces**: Check `models/interfaces.py` for contracts
- **Configuration**: All settings in `config/settings.py`









